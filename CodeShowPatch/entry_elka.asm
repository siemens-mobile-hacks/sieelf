#include "addr.h"

#ifdef E71Cv41
#define ADDR_DUMP1 0xA08009F8+1
#define ADDR_DUMP2 0xA051089E+1 //THUMB
#endif

	EXTERN	AppendInfoW
	EXTERN	UpdateLocaleToItem
	EXTERN	AddNewLine	
	EXTERN	GetProvAndCity
	EXTERN	GetNumFromIncomingPDU
	EXTERN	setMenuText
	
	RSEG	CODE

	DATA
MENU_HDR_ICON
	DCD	0x12E
	DCD	0
	
	CODE16
DUMP_A:
	PUSH {R0,LR}
	LDR	R0, =ADDR_DUMP1
	BLX	R0
	LDR	R0, =ADRBKLST_CATWS
	BLX	R0
	POP {R0,PC}
	
	CODE16
DUMP_B:
	PUSH {R0,LR}
	LDR	R0, =ADDR_DUMP1
	BLX	R0
	LDR	R0, =ADRBKLST_CATWS_2
	BLX	R0
	POP {R0,PC}

	CODE16
DUMP_C:
	PUSH {R0,LR}
	LDR	R0, =ADDR_DUMP1
	BLX	R0
	LDR	R0, =ADRBKLST_CATWS_3
	BLX	R0
	POP {R0,PC}
	
	CODE16
DUMP_D:
	PUSH {R0,LR}
	LDR	R0, =ADDR_DUMP2
	BLX	R0
	LDR	R0, =ADRBKLST_SIMNUMWS
	BLX	R0
	POP {R0,PC}
	
	CODE16
RecoedWindow_:
	PUSH	{LR}
	LDRB	R0, [R5, #9]
	CMP	R0, #7
	BCS	EX_PBACK
	LDR	R1, [R5, #4] //ºÅÂë WS ,ÅÐ¶ÏÒþ²ØºÅÂë
	LDR	R0, [R1, #0] //wsbody
	LDRH	R0, [R0, #0] //wslen
	CMP	R0, #0
	BEQ	EX_PBACK
	MOV	R0, R4
	BL	AddNewLine
	MOV	R0, R4
	LDR	R1, [R5, #4]
	BL	AppendInfoW
EX_PBACK
	MOV	R0, R4
	BL	AddNewLine
	MOV	R2, #1
	POP	{R0}
	ADD	R0, #4
	BX	R0

Callinwindow_:
	PUSH	{LR}
	LDR	R0, =ADDR_IsCalling
	BLX	R0
	MOV	R1, R0
	MOV	R0, #1
	MOV	R2, R4
	BL	UpdateLocaleToItem
	LDR	R0, =ADDR_CallIN
	BLX	R0
	CMP	R0, #0	
	POP	{R0}
	BEQ	HOOK1_EQ
	ADD	R0, #4
	BX	R0
HOOK1_EQ
	ADD	R0, #0xC
	BX	R0

CallOutWindow_:
	BEQ	SHOW_EQ
	MOV	R1, SP
	PUSH	{LR}
	LDR	R2, =ADDR_CallOUT2
	BLX	R2
	POP	{R2}
	ADD	R2, #4
	BX	R2
SHOW_EQ
	PUSH	{LR}
	LDR	R0, =ADDR_IsCalling
	BLX	R0
	MOV	R1, R0
	MOV	R0, #4
	MOV	R2, R4
	BL	UpdateLocaleToItem
	POP	{R0}
	ADD	R0, #0x14
	BX	R0

AddrBookWindow_:
	MOV	R4, SP
	PUSH	{LR}
	LDR	R2, =ADDR_AllocWS
	BLX	R2
	MOV	R1, R4
	MOV	R4, R0
	LDR	R2, =ADDR_ADDRBook
	BLX	R2
	MOV	R0, R4
	BL	AddNewLine
	MOV	R0, R4
	MOV	R1, R4
	BL	AppendInfoW
	POP	{R0}
	ADD	R0, #4
	BX	R0
	

SIMBOOK:
	PUSH	{LR}
	ADD	R1, R4, #0
	ADD	R0, R6, #0
	LDR	R3, =ADDR_GetPhoneBookNum
	BLX	R3
	MOV	R0,R4
	BL	AddNewLine
	MOV	R0, R4
	MOV	R1, R4
	BL	AppendInfoW
	POP	{R3}
	ADD	R3, #4
	BX	R3

#ifndef WITHOUT_SMS_IN_WIN
	CODE16
SMS_IN
	LDR	R0, [SP, #8]
	LDR	R2, [SP, #4]
	PUSH	{R0-R7, LR}
	MOV	R7, R0
	SUB	SP, #0x20
	LDR	R6, =0xAC5 //LGP ÐÂÐÅÏ¢
	CMP	R6, R2
	BNE	GoBack
	ADD	R0, SP, #0
	BL	GetNumFromIncomingPDU
	CMP	R0, #0
	BEQ	GoBack
	MOV	R0, R7
	BL	AddNewLine
	LDR	R0, [R7, #0]
	ADD	R1, SP, #0
	BL	GetProvAndCity
GoBack
	ADD	SP, #0x20
	POP	{R0-R7}
	POP	{R2}
	LDR	R0, [R0, #0] //WSTRLEN
	LDRH	R0, [R0, #0]
	STR	R0, [SP,#0xD8]
	ADD	R2, R2, #4
	BX	R2
#endif

NUM_SELECT_MENU_PSETTEXT: //R2, WS, 
	LDR	R0, [SP, #0x208] //GUI
	LDR	R3, [SP, #0x20C] //item_n
	LDR	R1, [SP, #0] //item
	MOV	R4, LR
	BL	setMenuText
	ADD	R4, #4
	BX	R4
	
	EXTERN	AddDialEQ
	EXTERN	DialGHookRedraw
	CODE32
EDIAL_CREATE
	ADD	LR, LR, #4
	STMFD	SP!,{LR}
	LDR	R0, [SP, #0x64] //EDITQ
	LDR	R1, [SP, #0x34] //ec
	LDR	R2, [SP, #0x20] //ecop
	MOV	R3, R7
	BLX	AddDialEQ
	MOV	R3, R7 //gui
	MOV	R2, #1
	MOV	R0, R4
	LDR	R1, [SP, #0x64] //editq
	LDMFD	SP!,{PC}
	
	CODE32
EDIAL_REDRAW
	ADD	LR, LR, #4
	STMFD	SP!,{LR}
	MOV	R0, R4
	BLX	DialGHookRedraw
	MOV	R2, #1
	MOV	R1, #1
	MOV	R0, R4
	BLX	ADDR_EDIT_UNK_VOID_INT_INT
	LDMFD	SP!,{PC}
	
	EXTERN	IsNum
	EXTERN	AddSpace
	CODE32
ADRBKLST_CATWS
	MOV	R4, LR
	LDR	R0, [R5, #0]
	MOV	R1, #1
	BLX	IsNum
	CMP	R0, #0
	MOVEQ	R0, R5
	BXEQ	R4
	MOV	R0, R5
	BLX	AddNewLine
	MOV	R0, R5
	MOV	R1, #4
	BLX	AddSpace
	LDR	R0, [R5, #0]
	ADD	R1, SP, #0x1C
	BLX	GetProvAndCity
	MOV	R0, R5
	BX	R4

	CODE32
ADRBKLST_SIMNUMWS
	STMFD	SP!,{LR}
	LDR	R0, [R8, #0]
	MOV	R1, #0
	BLX	IsNum
	CMP	R0, #0
	MOVEQ	R1, R10
	LDMEQFD	SP!,{PC}
	MOV	R0, R10
	BLX	AddNewLine
	MOV	R0, R10
	MOV	R1, R8
	BLX	AppendInfoW
	MOV	R1, R10
	LDMFD	SP!,{PC}	

	CODE32
ADRBKLST_CATWS_2
	STMFD	SP!,{LR}
	LDR	R0, [R4, #0]
	MOV	R1, #1
	BLX	IsNum
	CMP	R0, #0
	MOVEQ	R0, R4
	LDMEQFD	SP!,{PC}
	MOV	R0, R4
	BLX	AddNewLine
	MOV	R0, R4
	MOV	R1, #4
	BLX	AddSpace
	LDR	R0, [R4, #0]
	ADD	R1, SP, #4
	BLX	GetProvAndCity
	MOV	R0, R4
	LDMFD	SP!,{PC}

	CODE32
ADRBKLST_CATWS_3
	MOV	R4, LR
	LDR	R0, [SP,#0x21C]
	LDR	R0, [R0, #0]
	MOV	R1, #1
	BLX	IsNum
	CMP	R0, #0
	LDREQ	R0, [SP,#0x21C]
	BXEQ	R4
	LDR	R0, [SP,#0x21C]
	BLX	AddNewLine
	LDR	R0, [SP,#0x21C]
	MOV	R1, #4
	BLX	AddSpace
	LDR	R0, [SP,#0x21C]
	LDR	R0, [R0, #0]
	ADD	R1, SP, #0x1C
	BLX	GetProvAndCity
	LDR	R0, [SP,#0x21C]
	BX	R4
	
	RSEG	RecordWindow:CODE(2)
	CODE16
	LDR	R0, =RecoedWindow_
	BLX	R0
	
	RSEG	Callinwindow:CODE(2)
	CODE16
	LDR	R0, =Callinwindow_
	BLX	R0
	
	
	RSEG	CallOutWindow:CODE(2)
	CODE16
	LDR	R1, =CallOutWindow_
	BLX	R1

	RSEG	AddrBookWindow3:CODE(1)
	CODE16
	NOP
	
	RSEG	AddrBookWindow:CODE(2)
	CODE16
	LDR	R1, AddrBookWindow_P
	BLX	R1
	DATA
AddrBookWindow_P
	DCD	AddrBookWindow_
	CODE16
	NOP
	
	CODE16
	RSEG	PHONEBOOKHOOK:CODE(2)
	LDR	R1, =SIMBOOK
	BLX	R1

	
	RSEG	SMS_IN_HOOK
	CODE16
	LDR	R0, =SMS_IN
	BLX	R0
	
	RSEG	NUM_SELECT_MENU_HDR_ICON:DATA(2)
	DATA
	DCD	MENU_HDR_ICON
	
	RSEG	NUM_SELECT_MENU_LINES:DATA(2)
	DATA
	DCD	1
	
	RSEG	NUM_SELECT_MENU_ALITEM:CODE(2)
	CODE16
	BLX	AllocMLMenuItem_adr //void *AllocMLMenuItem(void *data)
	
	RSEG	NUM_SELECT_MENU_TEXT:CODE(2)
	CODE16
	LDR	R1, P_NUM_SELECT_MENU_PSETTEXT
	BLX	R1
	DATA
P_NUM_SELECT_MENU_PSETTEXT
	DCD	NUM_SELECT_MENU_PSETTEXT
	CODE16
	NOP
	
	RSEG	NUM_SELECT_MENU_GUI:CODE(1)
	CODE16
	BLX	GetMLMenuGUI_adr //ml menu gui
	
		
	RSEG	EDIAL_CREATE_HOOK
	CODE16
	LDR	R0, =EDIAL_CREATE
	BLX	R0
	
	RSEG	EDIAL_REDRAW_HOOK
	CODE16
	LDR	R0, =EDIAL_REDRAW
	BLX	R0

	RSEG	EDIAL_ATTR_HOOK
	CODE16
	STR	R1, [SP,#8]
	STR	R2, [SP,#4]
	MOV	R2, #1
	LSL	R2, R2, #0x13
	ADD	R2, #0x40
	
	RSEG	ADRBKLST_LINES_HOOK1
	DATA
	DCD	2
	
	RSEG	ADRBKLST_LINES_HOOK2
	DATA
	DCD	2
	
	RSEG	ADRBKLST_LINES_HOOK3
	DATA
	DCD	2
	
	RSEG	ADRBKLST_ALLOCWS_HOOK
 /*
 S7Cv47	
	ROM:A068485C 00 08 A0 E1                 MOV     R0, R0,LSL#16   ; ADRBKLST_ALLOCWS_HOOK
  ROM:A0684860 20 08 A0 E1                 MOV     R0, R0,LSR#16
	CODE32
	ADD	R0, R0, #0x20
	NOP
	
	E71Cv41
	ROM:A0800FD0 00 04                       LSLS    R0, R0, #0x10   ; ADRBKLST_ALLOCWS_HOOK
  ROM:A0800FD2 00 0C                       LSRS    R0, R0, #0x10
	*/
  CODE16
	ADD	R0, #0x20   //0x??
	NOP
	
	RSEG	ADRBKLST_CATWS_HOOK
	CODE16
	BLX	ADRBKLST_CATWS_DUMP_
	
	RSEG	ADRBKLST_CATWS_HOOK2
	CODE16
	BLX	ADRBKLST_CATWS_2DUMP_
	
	RSEG	ADRBKLST_CATWS_HOOK3
	CODE16
	BLX	ADRBKLST_CATWS_3DUMP_
	
//Diff 3
	RSEG	ADRBKLST_SIMALLWS_HOOK
	/*
	S7Cv47
	CODE32
	ADD	R1, R0, #0x20
	*/
	CODE16
	MOV	R1, R0
	ADD	R1, #0x20   //0x??
	
//Diff 4
	RSEG	ADRBKLST_ALLOCWS_HOOK2
	/* 
	S7Cv47
	CODE32
	ADD	R0, R7, #0x20
	*/
	CODE16
	MOV	R0, R7
	ADD	R0, #0x20
        
//Diff 6
	RSEG	ADRBKLST_ALLOCWS_HOOK3
	/*
	S7Cv47
  ROM:A0684BB0 00 08 A0 E1                 MOV     R0, R0,LSL#16   ; ADRBKLST_ALLOCWS_HOOK3 R0=R0*2E16
  ROM:A0684BB4 20 08 A0 E1                 MOV     R0, R0,LSR#16
	CODE32
	ADD	R0, R0, #0x20
	NOP
	
	E71Cv41
	ROM:A0801236 00 04                       LSLS    R0, R0, #0x10
  ROM:A0801238 00 0C                       LSRS    R0, R0, #0x10
  */	
	CODE16
	ADD	R0, #0x20
	NOP

	RSEG	ADRBKLST_SIMNUMWS_HOOK
	CODE16
	BLX	ADRBKLST_SIMNUMWS_DUMP_

	RSEG	HOOK_DUMP
	CODE32
	ADRBKLST_CATWS_DUMP_:
	LDR	R12, DUMP_A
	BX	R12
	
	CODE32
	ADRBKLST_CATWS_2DUMP_:
	LDR	R12, DUMP_B
	BX	R12
	
	CODE32
	ADRBKLST_CATWS_3DUMP_:
	LDR	R12, DUMP_C
	BX	R12
	
	RSEG	HOOK_DUMP2
	CODE32
	ADRBKLST_SIMNUMWS_DUMP_:
	LDR	R12, DUMP_D
	BX	R12

	END



